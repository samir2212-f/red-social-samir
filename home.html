<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
  import { 
    getFirestore, collection, addDoc, onSnapshot, doc, getDoc, orderBy, query 
  } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  // Configuración de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAbKtevrs-_LJuuNEh4IKX3o_vvpFddO5k",
    authDomain: "miredsocial-b50ce.firebaseapp.com",
    projectId: "miredsocial-b50ce",
    storageBucket: "miredsocial-b50ce.firebasestorage.app",
    messagingSenderId: "1087784350299",
    appId: "1:1087784350299:web:4c6b960635700994ef457e",
    measurementId: "G-97HJGYQX6B"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Publicar
  async function publicar(){
    const contenido = document.getElementById("contenido").value;
    const user = auth.currentUser;

    if(!user) return alert("Debes iniciar sesión");

    // Traer datos del usuario
    const userDoc = await getDoc(doc(db, "users", user.uid));
    const userData = userDoc.data();

    await addDoc(collection(db, "publicaciones"), {
      uid: user.uid,
      nombre: userData?.nombre || user.email,  
      contenido: contenido,
      fecha: new Date()
    });

    document.getElementById("contenido").value = "";
  }

  // Listar publicaciones con estilo
  const q = query(collection(db, "publicaciones"), orderBy("fecha", "desc"));
  onSnapshot(q, (snapshot) => {
    const lista = document.getElementById("lista");
    lista.innerHTML = "";
    snapshot.forEach((docSnap) => {
      const pub = docSnap.data();
      lista.innerHTML += `
        <div style="background:#181818; color:#fff; padding:15px; margin:15px 0; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.4);">
          <h3 style="margin:0; color:#4da6ff;">${pub.nombre}</h3>
          <p style="margin:8px 0;">${pub.contenido}</p>
          <small style="color:#aaa;">${pub.fecha.toDate ? pub.fecha.toDate().toLocaleString() : new Date(pub.fecha).toLocaleString()}</small>
        </div>
      `;
    });
  });

  window.publicar = publicar;
</script>

