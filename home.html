<input type="file" id="fileInput">

<script type="module">
  import { getStorage, ref, uploadBytes, getDownloadURL } 
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

  const storage = getStorage(app);

  // ðŸ”¹ Publicar con archivo
  async function publishPost() {
    const content = document.getElementById("postContent").value.trim();
    const file = document.getElementById("fileInput").files[0];

    let fileURL = null;

    if (file) {
      const storageRef = ref(storage, `uploads/${Date.now()}-${file.name}`);
      await uploadBytes(storageRef, file);
      fileURL = await getDownloadURL(storageRef);
    }

    if (content === "" && !fileURL) return;

    await addDoc(collection(db, "posts"), {
      uid: currentUser.uid,
      content: content,
      fileURL: fileURL,
      timestamp: serverTimestamp()
    });

    document.getElementById("postContent").value = "";
    document.getElementById("fileInput").value = "";
  }
  window.publishPost = publishPost;

  // ðŸ”¹ Mostrar publicaciones en tiempo real
  function loadPosts() {
    const q = query(collection(db, "posts"), orderBy("timestamp", "desc"));
    onSnapshot(q, (snapshot) => {
      const feedDiv = document.getElementById("feed");
      feedDiv.innerHTML = "";
      snapshot.forEach(doc => {
        const post = doc.data();
        const div = document.createElement("div");
        div.classList.add("post");

        let fileHTML = "";
        if (post.fileURL) {
          if (post.fileURL.match(/\.(jpeg|jpg|gif|png)$/i)) {
            fileHTML = `<img src="${post.fileURL}" style="max-width:100%; border-radius:8px; margin-top:10px;">`;
          } else {
            fileHTML = `<a href="${post.fileURL}" target="_blank">ðŸ“Ž Descargar archivo</a>`;
          }
        }

        div.innerHTML = `
          <p><strong style="color:#0af">${post.uid}</strong></p>
          <p>${post.content || ""}</p>
          ${fileHTML}
          <small>${post.timestamp ? post.timestamp.toDate().toLocaleString() : ""}</small>
        `;
        feedDiv.appendChild(div);
      });
    });
  }
</script>



