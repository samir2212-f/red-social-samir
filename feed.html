<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reels</title>
  <style>
    body { margin:0; background:black; overflow:hidden; }
    #feed {
      transition: transform 0.6s;
    }
    .reel {
      position:relative; height:100vh; width:100%;
      display:flex; justify-content:center; align-items:center;
    }
    video { height:100vh; width:100%; object-fit:cover; }
    .actions {
      position:absolute; right:15px; bottom:100px;
      display:flex; flex-direction:column; gap:20px; font-size:22px; color:white;
    }
    .actions button {
      background:rgba(0,0,0,0.5); border:none; border-radius:50%;
      width:50px; height:50px; color:white; font-size:22px; cursor:pointer;
    }
  </style>
</head>
<body>
  <div id="feed"></div>

  <!-- SDK de Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <script>
    // ‚ö° Configuraci√≥n Supabase
    const SUPABASE_URL = "https://klziukovalzzcinifvaw.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtseml1a292YWx6emNpbmlmdmF3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0Mzg1MDcsImV4cCI6MjA3MjAxNDUwN30.edpw-UnymgHSAhp54SX6CCKfEjB7SQDdSrhH3wc-Eh4";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    const feed = document.getElementById("feed");
    let current = 0;

    // ‚ö° Traer todos los videos del bucket Samir
    async function loadReels() {
      const { data, error } = await supabase.storage.from("Samir").list("", {
        limit: 100,
        sortBy: { column: "created_at", order: "desc" }
      });

      if (error) {
        console.error("Error cargando videos:", error.message);
        return;
      }

      for (let file of data) {
        const { data: urlData } = supabase
          .storage
          .from("Samir")
          .getPublicUrl(file.name);

        const fileUrl = urlData.publicUrl;

        let reel = document.createElement("div");
        reel.className = "reel";

        reel.innerHTML = `
          <video src="${fileUrl}" loop></video>
          <div class="actions">
            <button>‚ù§Ô∏è</button>
            <button>üí¨</button>
            <button>üîó</button>
          </div>
        `;
        feed.appendChild(reel);
      }

      // Reproducir el primer reel al cargar
      playCurrentReel();
    }

    loadReels();

    // üëâ Funci√≥n para mostrar y reproducir solo el reel actual
    function showReel(index) {
      const reels = document.querySelectorAll(".reel");
      if (index >= 0 && index < reels.length) {
        current = index;
        feed.style.transform = `translateY(-${current * 100}vh)`;
        playCurrentReel();
      }
    }

    // üëâ Reproduce solo el reel actual y pausa los dem√°s
    function playCurrentReel() {
      const videos = document.querySelectorAll("video");
      videos.forEach((video, i) => {
        if (i === current) {
          video.play();
        } else {
          video.pause();
          video.currentTime = 0; // opcional: reinicia al principio
        }
      });
    }

    // Scroll con rueda en PC
    window.addEventListener("wheel", e => {
      const reels = document.querySelectorAll(".reel");
      if (e.deltaY > 0 && current < reels.length - 1) showReel(current + 1);
      else if (e.deltaY < 0 && current > 0) showReel(current - 1);
    });

    // üëâ Swipe en celular
    let startY = 0;

    window.addEventListener("touchstart", e => {
      startY = e.touches[0].clientY;
    });

    window.addEventListener("touchend", e => {
      let endY = e.changedTouches[0].clientY;
      let diff = startY - endY;

      if (diff > 50) {
        showReel(current + 1); // subir ‚Üí siguiente reel
      } else if (diff < -50) {
        showReel(current - 1); // bajar ‚Üí reel anterior
      }
    });
  </script>
</body>
</html>
